services:
  # ===========================
  # BACKEND (Node.js API)
  # ===========================
  - type: web
    name: hrms-backend
    env: node
    plan: free
    rootDir: backend
    repo: https://github.com/abhi01326/evallo_assignment_hrms
    branch: main

    buildCommand: |
      npm ci --unsafe-perm
      npm run migrate || true
      npm run seed || true

    startCommand: node src/index.js

    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_FILE
        value: "/data/hrms.db"
      - key: JWT_SECRET
        generateValue: true

    disk:
      name: hrms-data
      mountPath: /data
      sizeGB: 1

    healthCheckPath: /api/health
    autoDeploy: true

  # ===========================
  # FRONTEND (React Static Site)
  # ===========================
  - type: web
    name: hrms-frontend
    env: static
    plan: free
    rootDir: frontend
    repo: https://github.com/abhi01326/evallo_assignment_hrms
    branch: main

    buildCommand: npm ci && npm run build
    publishPath: dist
